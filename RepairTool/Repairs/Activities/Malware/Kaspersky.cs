using System.Diagnostics;
using System.IO;
using RepairTool.Core;

namespace RepairTool.Repairs.Activities.Malware
{
    public class Kaspersky
    {
        public static void VirusRemovalTool()
        {
            var runFile = EnvironmentVars.WINMAL + "kaspersky_virus_removal_tool\\kvrt.exe";
            ProcessStartInfo vrt = new ProcessStartInfo();
            vrt.UseShellExecute = false;
            vrt.RedirectStandardOutput = true;
            vrt.Arguments = "-d " + EnvironmentVars.RAWLOGDIR + " -accepteula -adinsilent -silent -processlevel 2 -dontencyrpt";
            vrt.FileName = runFile;
            vrt.WindowStyle = ProcessWindowStyle.Hidden;
            vrt.CreateNoWindow = true;
            
            using (Process proc = Process.Start(vrt))
            {
                proc.WaitForExit();
                System.Threading.Thread.Sleep(30000);
                var output = proc.StandardOutput.ReadToEnd();
                using (StreamWriter w = File.AppendText(EnvironmentVars.LOGFILE))
                {
                    Logger.LogInfo(output, w);
                }
            }
            
            using (StreamWriter w = File.AppendText(EnvironmentVars.LOGFILE))
            {
                Logger.LogInfo("KVRT completed...", w);
            }
        }
    }
}