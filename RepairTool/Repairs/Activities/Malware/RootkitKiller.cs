using RepairTool.Core;
using System.IO;

namespace RepairTool.Repairs.Activities.Malware
{
    public static class RootkitKiller
    {
        public static void RunTask()
        {
            var runFile = EnvironmentVars.GLOBALREP + "tdss_killer\\TDSSKiller.exe";
            var repairType = "Malware Scans";
            var taskName = "TDSS Killer";
            var arguments = "-l " + EnvironmentVars.RAWLOGDIR + " -silent -tdlfs -dcexact -accepteula -accepteulaksn";
            var exitCode = -1;
            ProcessRunner.TaskRunner(repairType, taskName, runFile, arguments, exitCode);
            if (EnvironmentVars.WarningsDetected)
            {
                using (StreamWriter w = File.AppendText(EnvironmentVars.LOGFILE))
                {
                    Logger.LogWarning("TDSS Killer failed to run correctly.", w);
                }
            }
            EnvironmentVars.WarningsDetected = false;
        }
    }
}
