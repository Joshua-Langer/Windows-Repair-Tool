using RepairTool.Core;
using System.IO;

namespace RepairTool.Repairs.Activities.Malware
{
    public static class Stinger
    {
        public static void RunTask()
        {
            var runFile = EnvironmentVars.GLOBALREP + "mcafee_stinger\\stinger32.exe";
            var repairType = "Prep";
            var taskName = "McAfee Stinger";
            var arguments = "--GO --SILENT --PROGRAM --REPORTPATH=" + EnvironmentVars.RAWLOGDIR + " --DELETE";
            var exitCode = 0;
            ProcessRunner.TaskRunner(repairType, taskName, runFile, arguments, exitCode);
            if (EnvironmentVars.WarningsDetected)
            {
                using (StreamWriter w = File.AppendText(EnvironmentVars.LOGFILE))
                {
                    Logger.LogWarning("Stinger failed to run correctly", w);
                }
            }
            EnvironmentVars.WarningsDetected = false;
        }
    }
}
